name: Deploy DB to K3s

on:
  push:
    branches: [ "main" ] # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰

jobs:
  deploy:
    runs-on: self-hosted # ğŸŒŸ ìš°ë¦¬ ì§‘ ì„œë²„(Runner)ì—ì„œ ì‹¤í–‰

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Apply Kubernetes Manifests
        run: |
          echo "ğŸ“‚ Deploying Database..."
          # í˜„ì¬ í´ë”ì— ìˆëŠ” yaml íŒŒì¼ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì ìš©
          kubectl apply -f pvc.yaml
          kubectl apply -f deployment.yaml
          kubectl apply -f service.yaml
          
          echo "âœ… Deployment Applied!"
          
          # ë°°í¬ ìƒíƒœ í™•ì¸
          kubectl rollout status deployment/postgres-db